<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工管理系统 - 注册</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- 自定义CSS -->
    <link rel="stylesheet" href="/css/style-register.css">
</head>
<body>
<div class="register-wrapper">
    <!-- 左侧介绍区域 -->
    <div class="register-intro">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-users"></i>
            </div>
            <div class="logo-text">
                <h1>人事管理系统</h1>
                <span>Professional HR Management</span>
            </div>
        </div>

        <div class="intro-content">
            <h2>加入我们的团队<br>开启高效管理之旅</h2>
            <p>注册员工管理账户，体验智能化人力资源管理平台，助力企业提升管理效率。</p>

            <ul class="features">
                <li><i class="fas fa-check-circle"></i> 全面员工信息管理</li>
                <li><i class="fas fa-check-circle"></i> 智能考勤统计分析</li>
                <li><i class="fas fa-check-circle"></i> 自动化薪资核算</li>
                <li><i class="fas fa-check-circle"></i> 多维度报表生成</li>
                <li><i class="fas fa-check-circle"></i> 安全权限控制</li>
            </ul>
        </div>

        <div style="margin-top: auto; font-size: 12px; opacity: 0.7;">
            <p>© 2025 员工人事管理系统 v2.0</p>
        </div>
    </div>

    <!-- 右侧注册区域 -->
    <div class="register-container">
        <div class="register-header">
            <h2>创建新账户</h2>
            <p>请填写注册信息</p>
        </div>

        <form id="register-form">
            <div class="input-group">
                <input type="text" id="reg-username" placeholder="请输入用户名" required>
                <i class="fas fa-user"></i>
                <div class="error-message" id="username-error">请输入有效的用户名</div>
            </div>

            <div class="input-group">
                <input type="text" id="reg-phone" placeholder="请输入手机号" required>
                <i class="fas fa-phone"></i>
                <div class="error-message" id="phone-error">请输入有效的手机号</div>
            </div>

            <div class="input-group">
                <input type="password" id="reg-password" placeholder="请输入密码（至少6位）" required>
                <i class="fas fa-lock"></i>
                <div class="error-message" id="password-error">密码至少6位</div>
            </div>

            <div class="input-group">
                <input type="password" id="reg-confirm-password" placeholder="请确认密码" required>
                <i class="fas fa-lock"></i>
                <div class="error-message" id="confirm-error">两次密码不一致</div>
            </div>

            <div class="options">
                <div class="remember-me">
                    <input type="checkbox" id="agreeTerms">
                    <label for="agreeTerms">同意 <a href="#">用户协议</a> 和 <a href="#">隐私政策</a></label>
                </div>
            </div>

            <button type="submit" class="register-btn" id="register-button">
                <div class="spinner"></div>
                <span>注册账户</span>
                <i class="fas fa-user-plus"></i>
            </button>
        </form>

        <div class="divider">或使用其他方式注册</div>

        <div class="social-register">
            <button type="button" class="social-btn google">
                <i class="fab fa-google"></i>
                Google账号
            </button>
            <button type="button" class="social-btn microsoft">
                <i class="fab fa-microsoft"></i>
                微软账号
            </button>
        </div>

        <div class="register-footer">
            <p>已有账户？ <a href="login.html">立即登录</a></p>
            <p style="margin-top: 8px; font-size: 12px;">
                注册即表示您同意我们的服务条款
            </p>
        </div>
    </div>
</div>


<script>
        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            // 获取表单数据
            const preFormData = {
                username: document.getElementById("reg-username").value,
                phone: document.getElementById("reg-phone").value,
                password: document.getElementById("reg-password").value,
                confirmPassword: document.getElementById("reg-confirm-password").value
            };

            const formData = {
                username: document.getElementById("reg-username").value,
                phone: document.getElementById("reg-phone").value,
                password: await hashPassword(document.getElementById("reg-password").value),
                userAgent: navigator.userAgent
            };

            // 前端验证
            if (!validateForm(preFormData)) {
                return;
            }

            try {
                // 显示加载状态
                const submitBtn = document.querySelector('button[type="submit"]');
                submitBtn.textContent = '注册中...';
                submitBtn.disabled = true;

                // 发送POST请求到后端API
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    // 注册成功
                    alert('注册成功，请登录');
                    window.location.href = '/login'; // 使用Controller映射的路径
                } else {
                    // 注册失败，显示错误信息
                    alert('注册失败: ' + (result.message || '请检查输入信息'));
                }
            } catch (error) {
                console.error('注册请求错误:', error);
                alert('网络错误，请稍后重试');
            } finally {
                // 恢复按钮状态
                const submitBtn = document.querySelector('button[type="submit"]');
                submitBtn.textContent = '注册';
                submitBtn.disabled = false;
            }
        });

        // 表单验证函数
        function validateForm(data) {
            // 检查必填字段
            if (!data.username || !data.phone || !data.password || !data.confirmPassword) {
                alert('请填写所有必填字段');
                return false;
            }

            // 检查用户名长度
            if (data.username.length < 2 || data.username.length > 10) {
                alert('用户名长度应在2-10个字符之间');
                return false;
            }

            // 检查手机号格式

            // 检查密码长度
            if (data.password.length < 3) {
                alert('密码长度至少3位');
                return false;
            }

            // 检查密码确认
            if (data.password !== data.confirmPassword) {
                alert('两次输入的密码不一致');
                return false;
            }

            return true;
        }

        async function hashPassword(password) {
            // 将字符串编码为Uint8Array
            const encoder = new TextEncoder();
            const data = encoder.encode(password);

            // 使用SHA-256进行哈希
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);

            // 将ArrayBuffer转换为十六进制字符串
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            return hashHex;
        }
    </script>
</body>
</html>